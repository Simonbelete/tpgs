# Generated by Django 4.2 on 2023-08-05 16:14

from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='DirectoryList',
            fields=[
                ('id', models.BigAutoField(auto_created=True,
                 primary_key=True, serialize=False, verbose_name='ID')),
                ('farm_name', models.TextField()),
                ('farm_id', models.IntegerField()),
                ('flock_id', models.IntegerField()),
                ('flock_name', models.TextField()),
                ('house_id', models.IntegerField()),
                ('house_name', models.TextField()),
            ],
            options={
                'db_table': 'directory_list',
                'managed': False,
            },
        ),
        migrations.RunSQL(
            """
            CREATE MATERIALIZED VIEW directory_list AS 
                SELECT concat(ff.id, ff2.id, hh.id) AS unique_id, 
                    ff.schema_name AS farm_name, ff.id AS farm_id, 
                	ff2.name AS flock_name, ff2.id AS flock_id,
                	hh.name as house_name, hh.id AS house_id
                FROM farms_farm ff
                CROSS JOIN test.flocks_flock ff2, test.houses_house hh;
            """,
            """DROP VIEW directory_list"""
        )
    ]
